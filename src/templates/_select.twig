
{% if name is defined and name %}
    <input type="hidden" name="{{ name }}" value="">
{% endif %}
<div class="multiselect">
    <select style="width: 90%; height: 12rem;" name="{{ name }}[]" multiple>
        <option value="">{{ "None"|t }}</option>
        {% for option in products %}
            <option value="{{ option.productId }}"{% if option.productId in value %} selected{% endif %}>{{ option.label }} ({{ option.sku }})</option>
        {% endfor %}
    </select>
</div>

{% if filter_name is defined and filter_name %}
    <input style="width: 90%;" type="text" name="{{ filter_name }}" value="">
{% endif %}


<script>
document.addEventListener(
    'DOMContentLoaded',
    () => {
        let commerce_input = document.querySelector('[name="{{ filter_name }}"]');
        let commerce_select = document.querySelector('[name="{{ name }}[]"]');
        commerce_input.addEventListener(
            'keyup',
            (event) => {
                if (event.target.value) {
                    [...commerce_select.options].forEach(
                        (option) => {
                            let regex = new RegExp(event.target.value, 'ig');
                            if (regex.test(option.textContent)) {
                                option.hidden = false;
                            } else {
                                option.hidden = true;
                            }
                        }
                    );
                } else {
                    [...commerce_select.options].forEach(
                        (option) => {
                            option.hidden = false;
                        }
                    );
                }
            }
        );
    }
);
</script>

