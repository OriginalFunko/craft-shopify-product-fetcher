
{% if name is defined and name %}
    <input type="hidden" name="{{ name }}" value="">
{% endif %}
<div class="multiselect">
    <select style="width: 90%; height: 12rem;" name="{{ name }}[]" multiple>
        <option value="">{{ "None"|t }}</option>
        {% for option in products %}
            <option value="{{ option.productId }}"{% if option.productId in value %} selected{% endif %}>{{ option.label }} ({{ option.sku }})</option>
        {% endfor %}
    </select>
</div>

{% if filter_class is defined and filter_class %}
    <input style="width: 90%;" placeholder="Start typing to filter products ..." type="text" class="{{ filter_class }}" value="">
{% endif %}


<script>
(() => {
    const filterProducts = () => {
        let commerce_input = document.querySelector('[class*="{{ filter_class }}"]');
        let commerce_select = document.querySelector('select[name*="{{ name }}"]');
        commerce_input.addEventListener(
            'input',
            (event) => {
                if (event.target.value) {
                    [...commerce_select.options].forEach(
                        (option) => {
                            let regex = new RegExp(event.target.value, 'ig');
                            if (regex.test(option.textContent)) {
                                option.hidden = false;
                            } else {
                                option.hidden = true;
                            }
                        }
                    );
                } else {
                    [...commerce_select.options].forEach(
                        (option) => {
                            option.hidden = false;
                        }
                    );
                }
            }
        );
    };

    filterProducts();
    document.addEventListener(
        'DOMContentLoaded',
        () => {
            filterProducts();
        }
    );
})();
</script>

